"use strict";(self.webpackChunk_8x8_developer_docs=self.webpackChunk_8x8_developer_docs||[]).push([[52968],{28453:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>c});var i=t(96540);const l={},s=i.createContext(l);function r(n){const e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:r(n.components),i.createElement(s.Provider,{value:e},n.children)}},93317:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"connect/docs/call-action-handling","title":"Call Action Handling (Number Masking)","description":"This method provides insights about call details and will be sent to your \\"Voice Call Action\\" (VCA) endpoint. Your \\"Voice Call Action\\" (VCA) endpoint can be configured on the sub-account level with the Number Masking Webhooks.","source":"@site/docs/connect/docs/call-action-handling.md","sourceDirName":"connect/docs","slug":"/connect/docs/call-action-handling","permalink":"/production/connect/docs/call-action-handling","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"sidebarConnectReference","previous":{"title":"Call Status (Number Masking)","permalink":"/production/connect/docs/call-status"},"next":{"title":"Session Summary (Number Masking)","permalink":"/production/connect/docs/session-summary-number-masking"}}');var l=t(74848),s=t(28453);const r={},c="Call Action Handling (Number Masking)",d={},o=[{value:"Call Action Request",id:"call-action-request",level:2},{value:"Responding to Call Action Request",id:"responding-to-call-action-request",level:2},{value:"makeCall",id:"makecall",level:2},{value:"say",id:"say",level:2},{value:"playFile",id:"playfile",level:2},{value:"hangup",id:"hangup",level:2},{value:"Commands Example",id:"commands-example",level:2}];function a(n){const e={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"call-action-handling-number-masking",children:"Call Action Handling (Number Masking)"})}),"\n",(0,l.jsxs)(e.p,{children:['This method provides insights about call details and will be sent to your "Voice Call Action" (VCA) endpoint. Your "Voice Call Action" (VCA) endpoint can be configured on the sub-account level with the Number Masking ',(0,l.jsx)(e.a,{href:"/connect/reference/create-a-new-webhook",children:"Webhooks"}),"."]}),"\n",(0,l.jsx)(e.h2,{id:"call-action-request",children:"Call Action Request"}),"\n",(0,l.jsx)(e.p,{children:"When receiving an incoming call to your virtual number 8x8 platform will POST a JSON object to your URL."}),"\n",(0,l.jsx)(e.p,{children:"The JSON object will contain the following values:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"Name"}),(0,l.jsx)(e.th,{children:"Type"}),(0,l.jsx)(e.th,{children:"Description"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"namespace"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"8x8 product channel definition"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"eventType"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Current call handle event type. CALL_ACTION"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"description"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Description of the current call handle event type"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"payload"}),(0,l.jsx)(e.td,{children:"object"}),(0,l.jsx)(e.td,{children:"contains call information about the current number masking session"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"eventId"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Id unique to an event of the current number masking session [UUID]"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"callId"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Id unique to a call leg of the current number masking session [UUID]"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"sessionId"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Id unique to the current number masking session [UUID]"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"subAccountId"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"unique id for your subaccount"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"callStatus"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsxs)(e.td,{children:["Status of the current call leg. Values can be:",(0,l.jsx)(e.br,{}),"CALL_RECEIVED (only for number masking)"]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"callDirection"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Direction of the call leg. INBOUND (Inbound only for number masking)"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"callType"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"For Number Masking the call type is always PSTN"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"source"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Source number of the call leg."})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"destination"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Destination number of the call leg."})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"sourceFormat"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Source format for number masking is always MSISDN"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"sourceCountryCode"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Country code of the source number"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"destinationCountryCode"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Country code of the destination number"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"destinationRefId"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsxs)(e.td,{children:["Reference Id for the virtual number (this is from your ",(0,l.jsx)(e.a,{href:"/connect/reference/number-health-service",children:"Get My Virtual Number Endpoint"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"callDuration"}),(0,l.jsx)(e.td,{children:"Integer"}),(0,l.jsxs)(e.td,{children:["Call duration for the current call leg. For the number masking scenario, ",(0,l.jsx)(e.code,{children:"callDuration"}),' would be "0".']})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"sipCode"}),(0,l.jsx)(e.td,{children:"Integer"}),(0,l.jsx)(e.td,{children:"Final Sip status code for the call leg defined by RFC 3261"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Timestamp"}),(0,l.jsx)(e.td,{children:"Timestamp"}),(0,l.jsx)(e.td,{children:"Timestamp of the processed event"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:"Example of a JSON object sent to your handleURL:"}),"\n",(0,l.jsx)(e.p,{children:"VCA - Call Action Request"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\n  "namespace": "VOICE",\n  "eventType": "CALL_ACTION",\n  "description": "Action request of a call",\n  "payload": {\n    "eventId": "eb0fc709-9693-11ea-454d-1705dde98182",\n    "callId": "a1d6a5e3-efec-11e9-b999-7d370b5f90d1",\n    "sessionId": "a1d6a5e2-efec-11e9-b999-efc71013a78f",\n    "subAccountId": "your_subaccount_id",\n    "callStatus": "CALL_RECEIVED",\n    "callDirection": "INBOUND",\n    "callType": "PSTN",\n    "source": "+65123456789",\n    "destination": "+65987654321",\n    "sourceFormat": "MSISDN",\n    "destinationFormat": "MSISDN",\n    "sourceCountryCode": "SG",\n    "destinationCountryCode": "SG",\n    "destinationRefId": "vn-ref-1",\n    "callDuration": 0,\n    "sipCode": 200,\n    "timestamp": "2019-10-16T08:12:01Z"\n  }\n}\n\n'})}),"\n",(0,l.jsx)(e.h2,{id:"responding-to-call-action-request",children:"Responding to Call Action Request"}),"\n",(0,l.jsx)(e.p,{children:"To start your call flow you need to reply to the call action request with an HTTP 200 response code including a Call Action in the HTTP response body. The supported Call Actions are:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"makeCall - Initiates an outgoing call to the desired destination. This function should be used to connect the first call with another party."}),"\n",(0,l.jsx)(e.li,{children:"say - Generates and plays a TTS to the calling user."}),"\n",(0,l.jsx)(e.li,{children:"hangup - Disconnects all active calls. This will terminate the session, triggering the session summary webhook."}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"makecall",children:"makeCall"}),"\n",(0,l.jsx)(e.p,{children:"This function should be used to connect the first call with another party."}),"\n",(0,l.jsx)(e.p,{children:"The following is an example of the JSON response you would need to provide:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\n   "clientActionId": "NumberMaskingId1",\n   "callflow": [\n      {\n         "action": "makeCall",\n         "params": {\n            "source": "6512345678",\n            "destination": "6587654321",\n            "callRecording": true //Optional. Use only if call recording has been set up.\n         }\n      }\n   ]\n}\n\n'})}),"\n",(0,l.jsx)(e.p,{children:"The action should contain the following parameters:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"Name"}),(0,l.jsx)(e.th,{children:"Type"}),(0,l.jsx)(e.th,{children:"Description"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"action"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"MakeCall \u2013 Action to Connect/Bridge call between two users"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"destination"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Number of the called party in E.164 format (The second user's number)."})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"source"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"Number of the calling party in E.164 format. This should be the Virtual Number allocated to your sub-account"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"callRecording"}),(0,l.jsx)(e.td,{children:"Boolean"}),(0,l.jsxs)(e.td,{children:["(Optional) Trigger to start recording the Number Masking session. Before using this option please reach out to your Account Manager since this option might include additional costs. Additionally please make sure that the Call Recording has been configured on your account. To configure call recording please take a look at ",(0,l.jsx)(e.a,{href:"/connect/reference/call-recordings",children:"Call Recordings"})]})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"say",children:"say"}),"\n",(0,l.jsx)(e.p,{children:"This action should be used to play a text to speech message on the call."}),"\n",(0,l.jsx)(e.p,{children:"The following is an example of the JSON response you would need to provide:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\n  "clientActionId": "NumberMaskingId1",\n  "callflow": [\n    {\n      "action": "say",\n      "params": {\n        "text": "Hello This is a test message",\n        "voiceProfile": "en-US-ZiraRUS",\n        "repetition": 1,//optional(default is 1)\n        "speed": 1.0,//optional(defailt is 1)\n      }\n    }\n  ]\n}\n\n'})}),"\n",(0,l.jsx)(e.p,{children:"The above example would be used if you want the message"}),"\n",(0,l.jsx)(e.p,{children:"The action should contain the following parameters:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"Name"}),(0,l.jsx)(e.th,{children:"Type"}),(0,l.jsx)(e.th,{children:"Description"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"action"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"say \u2013 Text to speech function"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"text"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"The text to speech message that will be played on the call"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"voiceProfile"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsxs)(e.td,{children:["The voice profile of the spoken text, see in the table below the supported voice profiles. Please use ",(0,l.jsx)(e.a,{href:"/connect/reference/get-voice-profile-information",children:"Voice Profile API"})," to retrieve ",(0,l.jsx)(e.code,{children:"voiceProfile"})]})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"repetition"}),(0,l.jsx)(e.td,{children:"Integer"}),(0,l.jsx)(e.td,{children:"Defines the number of times the text will be repeated during the call."})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"speed"}),(0,l.jsx)(e.td,{children:"Float"}),(0,l.jsx)(e.td,{children:"Controls the speed of the speech"})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"playfile",children:"playFile"}),"\n",(0,l.jsx)(e.p,{children:"Downloads the sound/voice file provided and plays it back in the currently active call."}),"\n",(0,l.jsx)(e.p,{children:"File type requirements:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Supported file types are .wav and mp3."}),"\n",(0,l.jsx)(e.li,{children:"API only accepts file that is smaller than 5MB."}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"The following is an example of the JSON response you would need to provide:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\n  "clientActionId": "ivr1_level2",\n  "callflow": [\n    {\n    "action": "playFile",\n    "params": {\n      "fileUrl": "https://sample-videos.com/audio/mp3/wave.mp3",  // mandatory\n      "repetition": 1   //optional\n      }\n    }\n  ]\n}\n\n'})}),"\n",(0,l.jsx)(e.p,{children:"The action should contain the following parameters:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"Name"}),(0,l.jsx)(e.th,{children:"Type"}),(0,l.jsx)(e.th,{children:"Description"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"action"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"say \u2013 play a recorded file into a currently active call funtion"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"fileUrl"}),(0,l.jsx)(e.td,{children:"String"}),(0,l.jsx)(e.td,{children:"The public link of the hosted voice file"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"repetition"}),(0,l.jsx)(e.td,{children:"Integer"}),(0,l.jsx)(e.td,{children:"Defines the number of times the text will be repeated during the call. Default repetition is 1. Max repetition is 3"})]})]})]}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"\ud83d\udcd8Downloaded Voice files"}),"\n",(0,l.jsx)(e.p,{children:"Downloaded voice files are cached for 1 hour for faster access, if used in consequent requests. If the file content is changed within 1 hour after the first request, make sure to change the file name for the changes to be reflected in the calls afterward"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"hangup",children:"hangup"}),"\n",(0,l.jsx)(e.p,{children:"This action should be used to hang up the incoming call."}),"\n",(0,l.jsx)(e.p,{children:"The following is an example of the JSON response you would need to provide:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\n  "clientActionId": "NumberMaskingId1",\n  "callflow": [ \n    {\n      "action": "hangup" \n    }\n  ]\n}\n\n'})}),"\n",(0,l.jsx)(e.p,{children:"Note: The Hangup action terminates the active call session."}),"\n",(0,l.jsx)(e.h2,{id:"commands-example",children:"Commands Example"}),"\n",(0,l.jsx)(e.p,{children:"On the following example it is demonstrated how multiple actions can be used in the same call action handle reply:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\n  "clientActionId": "NumberMaskingId1",\n  "callflow": [ \n    {\n      "action": "say",\n        "params": {\n          "text": "Hello This is a test message",\n          "voiceProfile": "en-US-ZiraRUS",\n          "repetition": 1,//optional(default is 1)\n          "speed": 1.0,//optional(defailt is 1)\n      }\n    },\n    {\n      "action": "hangup" \n    }\n  ] \n}\n\n'})})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}}}]);