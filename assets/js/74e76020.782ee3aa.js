"use strict";(globalThis.webpackChunk_8x8_developer_docs=globalThis.webpackChunk_8x8_developer_docs||[]).push([[45386],{25202:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"actions-events/docs/streaming/examples/golang","title":"Go Client Example","description":"This page provides a complete Go implementation for connecting to the 8x8 Event Streaming service.","source":"@site/docs/actions-events/docs/streaming/examples/golang.md","sourceDirName":"actions-events/docs/streaming/examples","slug":"/actions-events/docs/streaming/examples/golang","permalink":"/actions-events/docs/streaming/examples/golang","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"sidebarActionsEventsDocs","previous":{"title":"Migration Guide","permalink":"/actions-events/docs/streaming/migration"},"next":{"title":"Java Client Example","permalink":"/actions-events/docs/streaming/examples/java"}}');var a=s(74848),t=s(28453);const i={sidebar_position:1},o="Go Client Example",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Key Components",id:"key-components",level:2},{value:"Message Structure",id:"message-structure",level:3},{value:"URL Construction",id:"url-construction",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Payload Decoding",id:"payload-decoding",level:3},{value:"Message Acknowledgement",id:"message-acknowledgement",level:3},{value:"Control Message Filtering",id:"control-message-filtering",level:3},{value:"Running the Example",id:"running-the-example",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Build and Run",id:"build-and-run",level:3},{value:"Using Environment Variables",id:"using-environment-variables",level:3},{value:"Processing with jq",id:"processing-with-jq",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"go-client-example",children:"Go Client Example"})}),"\n",(0,a.jsx)(n.p,{children:"This page provides a complete Go implementation for connecting to the 8x8 Event Streaming service."}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"The Go client example demonstrates:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"WebSocket connection setup"}),"\n",(0,a.jsx)(n.li,{children:"Authentication using X-API-Key"}),"\n",(0,a.jsx)(n.li,{children:"Message reading and payload decoding"}),"\n",(0,a.jsx)(n.li,{children:"Error handling and graceful shutdown"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "encoding/base64"\n    "encoding/json"\n    "flag"\n    "fmt"\n    "log"\n    "net/http"\n    "net/url"\n    "time"\n\n    "github.com/gorilla/websocket"\n)\n\n// PulsarMessage represents a message received from Pulsar WebSocket\ntype PulsarMessage struct {\n    // Data message fields\n    MessageID       string            `json:"messageId"`\n    Payload         string            `json:"payload"` // Base64 encoded\n    Properties      map[string]string `json:"properties,omitempty"`\n    PublishTime     string            `json:"publishTime,omitempty"`\n    RedeliveryCount int               `json:"redeliveryCount,omitempty"`\n    // Control message fields\n    Type       string `json:"type,omitempty"`       // e.g., "isEndOfTopic"\n    EndOfTopic string `json:"endOfTopic,omitempty"` // "true" or "false"\n}\n\n// IsControlMessage returns true if this is a control message (should not be acknowledged)\nfunc (m *PulsarMessage) IsControlMessage() bool {\n    return m.Type != "" || m.EndOfTopic != ""\n}\n\n// DecodePayload decodes the base64 payload\nfunc (m *PulsarMessage) DecodePayload() ([]byte, error) {\n    return base64.StdEncoding.DecodeString(m.Payload)\n}\n\n// extractPulsarPayload parses a Pulsar message and extracts the decoded payload\nfunc extractPulsarPayload(data []byte) (*PulsarMessage, []byte, error) {\n    var msg PulsarMessage\n    if err := json.Unmarshal(data, &msg); err != nil {\n        return nil, nil, fmt.Errorf("failed to parse Pulsar message: %w", err)\n    }\n\n    payload, err := msg.DecodePayload()\n    if err != nil {\n        return &msg, nil, fmt.Errorf("failed to decode payload: %w", err)\n    }\n\n    return &msg, payload, nil\n}\n\n// sendAck sends an acknowledgment message for a received message\n// This is REQUIRED for WebSocket readers to prevent backlog buildup and message delivery stoppage\nfunc sendAck(conn *websocket.Conn, messageID string) error {\n    ackMsg := map[string]string{"messageId": messageID}\n    ackJSON, err := json.Marshal(ackMsg)\n    if err != nil {\n        return fmt.Errorf("failed to marshal ack message: %w", err)\n    }\n\n    err = conn.WriteMessage(websocket.TextMessage, ackJSON)\n    if err != nil {\n        return fmt.Errorf("failed to send ack: %w", err)\n    }\n\n    return nil\n}\n\n// buildURL constructs the Pulsar WebSocket URL\nfunc buildURL(host string, port int, tenant, namespace, topic, xAPIKey string) (string, error) {\n    baseURL := fmt.Sprintf("wss://%s:%d/ws/v2/reader/persistent/%s/%s/%s", host, port, tenant, namespace, topic)\n\n    u, err := url.Parse(baseURL)\n    if err != nil {\n        return "", fmt.Errorf("invalid URL: %w", err)\n    }\n\n    // Add X-API-Key as query parameter if provided\n    if xAPIKey != "" {\n        q := u.Query()\n        q.Set("x-api-key", xAPIKey)\n        u.RawQuery = q.Encode()\n    }\n\n    return u.String(), nil\n}\n\n// ConnectAndReceive connects to a WebSocket URL and receives messages\nfunc ConnectAndReceive(wsURL string, xAPIKey string) error {\n    // Set up HTTP headers for authentication\n    headers := http.Header{}\n\n    // Add X-API-Key header if provided\n    if xAPIKey != "" {\n        headers.Set("X-API-Key", xAPIKey)\n    }\n\n    // Configure WebSocket dialer\n    dialer := websocket.Dialer{\n        HandshakeTimeout: 45 * time.Second,\n    }\n\n    // Connect to WebSocket\n    log.Printf("Connecting to WebSocket...")\n    conn, resp, err := dialer.Dial(wsURL, headers)\n    if err != nil {\n        if resp != nil {\n            return fmt.Errorf("failed to connect to WebSocket (status: %d): %w", resp.StatusCode, err)\n        }\n        return fmt.Errorf("failed to connect to WebSocket: %w", err)\n    }\n    defer conn.Close()\n\n    log.Printf("Successfully connected")\n\n    // Read messages continuously\n    for {\n        messageType, message, err := conn.ReadMessage()\n        if err != nil {\n            log.Printf("Error reading message: %v", err)\n            return err\n        }\n\n        switch messageType {\n        case websocket.TextMessage, websocket.BinaryMessage:\n            // Extract and decode Pulsar message payload\n            pulsarMsg, payload, err := extractPulsarPayload(message)\n            if err != nil {\n                log.Printf("Error extracting payload: %v", err)\n                continue\n            }\n\n            // Check if this is a control message (don\'t print or ack these)\n            if pulsarMsg.IsControlMessage() {\n                continue\n            }\n\n            // Print only the payload\n            fmt.Println(string(payload))\n\n            // Send acknowledgment (required for WebSocket flow control)\n            if err := sendAck(conn, pulsarMsg.MessageID); err != nil {\n                log.Printf("Warning: Failed to send ack: %v", err)\n            }\n\n        case websocket.CloseMessage:\n            log.Println("Received close message from server")\n            return nil\n        }\n    }\n}\n\nfunc main() {\n    // Connection parameters\n    // Default host: pulsar-ws-euw2.8x8.com (example uses euw2 region; for other regions see developer.8x8.com)\n    host := flag.String("host", "pulsar-ws-euw2.8x8.com", "Pulsar broker hostname")\n    port := flag.Int("port", 443, "Pulsar broker port")\n    tenant := flag.String("tenant", "", "Pulsar tenant name (required)")\n    namespace := flag.String("namespace", "event-v1", "Pulsar namespace")\n    topic := flag.String("topic", "all", "Pulsar topic name")\n    xAPIKey := flag.String("x-api-key", "", "X-API-Key header value")\n\n    flag.Parse()\n\n    // Validate required parameters\n    if *tenant == "" {\n        log.Fatal("Error: -tenant is required")\n    }\n\n    // Build full URL\n    fullURL, err := buildURL(*host, *port, *tenant, *namespace, *topic, *xAPIKey)\n    if err != nil {\n        log.Fatalf("Error building URL: %v", err)\n    }\n\n    // Connect and receive messages\n    if err := ConnectAndReceive(fullURL, *xAPIKey); err != nil {\n        log.Fatalf("Error: %v", err)\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"key-components",children:"Key Components"}),"\n",(0,a.jsx)(n.h3,{id:"message-structure",children:"Message Structure"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"PulsarMessage"})," struct maps to the JSON structure received from Pulsar:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'type PulsarMessage struct {\n  MessageID       string            `json:"messageId"`\n  Payload         string            `json:"payload"` // Base64 encoded\n  Properties      map[string]string `json:"properties,omitempty"`\n  PublishTime     string            `json:"publishTime,omitempty"`\n  RedeliveryCount int               `json:"redeliveryCount,omitempty"`\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"url-construction",children:"URL Construction"}),"\n",(0,a.jsx)(n.p,{children:"The client builds the WebSocket URL from components:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'baseURL := fmt.Sprintf("wss://%s:%d/ws/v2/reader/persistent/%s/%s/%s",\n  host, port, tenant, namespace, topic)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,a.jsx)(n.p,{children:"X-API-Key is set both as a header and query parameter:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'headers := http.Header{}\nheaders.Set("X-API-Key", xAPIKey)\n\n// Also add to URL query params\nq := u.Query()\nq.Set("x-api-key", xAPIKey)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"payload-decoding",children:"Payload Decoding"}),"\n",(0,a.jsx)(n.p,{children:"The payload is base64 encoded and must be decoded before use:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:"payload, err := base64.StdEncoding.DecodeString(pulsarMsg.Payload)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"message-acknowledgement",children:"Message Acknowledgement"}),"\n",(0,a.jsx)(n.p,{children:"Acknowledgements are required to prevent message delivery stoppage:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'ackMsg := map[string]string{"messageId": messageID}\nackJSON, _ := json.Marshal(ackMsg)\nconn.WriteMessage(websocket.TextMessage, ackJSON)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"control-message-filtering",children:"Control Message Filtering"}),"\n",(0,a.jsx)(n.p,{children:"Control messages (like end-of-topic markers) should not be processed:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:"if pulsarMsg.IsControlMessage() {\n    continue\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"running-the-example",children:"Running the Example"}),"\n",(0,a.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"go install github.com/gorilla/websocket@latest\n"})}),"\n",(0,a.jsx)(n.h3,{id:"build-and-run",children:"Build and Run"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Build\ngo build -o pulsar-client main.go\n\n# Run\n./pulsar-client \\\n  -tenant YOUR_TENANT \\\n  -x-api-key YOUR_API_KEY\n"})}),"\n",(0,a.jsx)(n.h3,{id:"using-environment-variables",children:"Using Environment Variables"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"export PULSAR_TENANT=your-tenant\nexport PULSAR_API_KEY=your-api-key\n\n./pulsar-client \\\n  -tenant $PULSAR_TENANT \\\n  -x-api-key $PULSAR_API_KEY\n"})}),"\n",(0,a.jsx)(n.h2,{id:"processing-with-jq",children:"Processing with jq"}),"\n",(0,a.jsxs)(n.p,{children:["Pipe the output to ",(0,a.jsx)(n.code,{children:"jq"})," for JSON processing:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Pretty-print all events\n./pulsar-client -tenant YOUR_TENANT -x-api-key YOUR_KEY | jq .\n\n# Filter by event type\n./pulsar-client -tenant YOUR_TENANT -x-api-key YOUR_KEY | \\\n  jq 'select(.eventType == \"agent.login\")'\n\n# Extract specific fields\n./pulsar-client -tenant YOUR_TENANT -x-api-key YOUR_KEY | \\\n  jq '{type: .eventType, time: .timestamp}'\n"})}),"\n",(0,a.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsx)(n.p,{children:"The example includes error handling for:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Invalid URL construction"}),"\n",(0,a.jsx)(n.li,{children:"Connection failures with HTTP status codes"}),"\n",(0,a.jsx)(n.li,{children:"WebSocket read errors"}),"\n",(0,a.jsx)(n.li,{children:"JSON parsing errors"}),"\n",(0,a.jsx)(n.li,{children:"Base64 decoding errors"}),"\n",(0,a.jsx)(n.li,{children:"Acknowledgement send failures"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/actions-events/docs/streaming/examples/java",children:"Java Client Example"})," - See the same functionality in Java"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/actions-events/docs/streaming/message-format",children:"Message Format"})," - Learn more about message structure"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/actions-events/docs/streaming/troubleshooting",children:"Troubleshooting"})," - Common issues and solutions"]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var r=s(96540);const a={},t=r.createContext(a);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);