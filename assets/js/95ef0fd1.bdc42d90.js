"use strict";(globalThis.webpackChunk_8x8_developer_docs=globalThis.webpackChunk_8x8_developer_docs||[]).push([[84143],{28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>o});var r=a(96540);const t={},s=r.createContext(t);function i(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(s.Provider,{value:n},e.children)}},94225:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"actions-events/docs/streaming/examples/java","title":"Java Client Example","description":"This page provides a complete Java implementation for connecting to the 8x8 Event Streaming service.","source":"@site/docs/actions-events/docs/streaming/examples/java.md","sourceDirName":"actions-events/docs/streaming/examples","slug":"/actions-events/docs/streaming/examples/java","permalink":"/actions-events/docs/streaming/examples/java","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"sidebarActionsEventsDocs","previous":{"title":"Go Client Example","permalink":"/actions-events/docs/streaming/examples/golang"},"next":{"title":"Python Client Example","permalink":"/actions-events/docs/streaming/examples/python"}}');var t=a(74848),s=a(28453);const i={sidebar_position:2},o="Java Client Example",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Key Components",id:"key-components",level:2},{value:"Message Structure",id:"message-structure",level:3},{value:"URL Construction",id:"url-construction",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Payload Decoding",id:"payload-decoding",level:3},{value:"Message Acknowledgement",id:"message-acknowledgement",level:3},{value:"Control Message Filtering",id:"control-message-filtering",level:3},{value:"Maven Dependencies",id:"maven-dependencies",level:2},{value:"Building and Running",id:"building-and-running",level:2},{value:"Build with Maven",id:"build-with-maven",level:3},{value:"Run the JAR",id:"run-the-jar",level:3},{value:"Using Environment Variables",id:"using-environment-variables",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"java-client-example",children:"Java Client Example"})}),"\n",(0,t.jsx)(n.p,{children:"This page provides a complete Java implementation for connecting to the 8x8 Event Streaming service."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The Java client example demonstrates:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"WebSocket connection using Java-WebSocket library"}),"\n",(0,t.jsx)(n.li,{children:"Authentication using X-API-Key"}),"\n",(0,t.jsx)(n.li,{children:"Message reading and payload decoding"}),"\n",(0,t.jsx)(n.li,{children:"Command-line argument parsing"}),"\n",(0,t.jsx)(n.li,{children:"Error handling with proper logging"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'package com._8x8.pulsar;\n\nimport com.fasterxml.jackson.annotation.JsonProperty;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.Data;\nimport org.java_websocket.client.WebSocketClient;\nimport org.java_websocket.handshake.ServerHandshake;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport java.net.URI;\nimport java.net.URLEncoder;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Base64;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.CountDownLatch;\n\n/**\n * Simplified WebSocket client for consuming 8x8 streaming events via Apache Pulsar.\n * <p>\n * This client connects to Pulsar\'s WebSocket Reader endpoint and outputs raw message payloads\n * suitable for piping to tools like jq.\n */\npublic class SimpleClient {\n    private static final Logger log = LoggerFactory.getLogger(SimpleClient.class);\n    private static final ObjectMapper objectMapper = new ObjectMapper();\n\n    /**\n     * Pulsar message structure from WebSocket.\n     */\n    @Data\n    static class PulsarMessage {\n        // Data message fields\n        @JsonProperty("messageId")\n        private String messageId;\n\n        @JsonProperty("payload")\n        private String payload; // Base64 encoded\n\n        @JsonProperty("properties")\n        private Map<String, String> properties = new HashMap<>();\n\n        @JsonProperty("publishTime")\n        private String publishTime;\n\n        @JsonProperty("redeliveryCount")\n        private int redeliveryCount;\n\n        // Control message fields\n        @JsonProperty("type")\n        private String type; // e.g., "isEndOfTopic"\n\n        @JsonProperty("endOfTopic")\n        private String endOfTopic; // "true" or "false"\n\n        /**\n         * Check if this is a control message (should not be acknowledged).\n         */\n        public boolean isControlMessage() {\n            return (type != null && !type.isEmpty()) || (endOfTopic != null && !endOfTopic.isEmpty());\n        }\n\n        /**\n         * Decode the base64 payload.\n         */\n        public byte[] decodePayload() {\n            return Base64.getDecoder().decode(payload);\n        }\n\n        /**\n         * Decode payload as UTF-8 string.\n         */\n        public String decodePayloadAsString() {\n            return new String(decodePayload(), StandardCharsets.UTF_8);\n        }\n    }\n\n    /**\n     * Build Pulsar WebSocket URL.\n     */\n    private static String buildUrl(String host, int port, String tenant, String namespace,\n                                    String topic, String xApiKey) {\n        try {\n            String baseUrl = String.format("wss://%s:%d/ws/v2/reader/persistent/%s/%s/%s",\n                    host, port, tenant, namespace, topic);\n\n            if (xApiKey != null && !xApiKey.isEmpty()) {\n                baseUrl += "?x-api-key=" + URLEncoder.encode(xApiKey, StandardCharsets.UTF_8);\n            }\n\n            return baseUrl;\n        } catch (Exception e) {\n            throw new RuntimeException("Failed to build URL", e);\n        }\n    }\n\n    /**\n     * WebSocket client implementation.\n     */\n    static class PulsarWebSocketClient extends WebSocketClient {\n        private final CountDownLatch latch = new CountDownLatch(1);\n        private final String xApiKey;\n\n        public PulsarWebSocketClient(URI serverUri, String xApiKey) {\n            super(serverUri);\n            this.xApiKey = xApiKey;\n\n            // Add X-API-Key header if provided\n            if (xApiKey != null && !xApiKey.isEmpty()) {\n                addHeader("X-API-Key", xApiKey);\n            }\n\n            // Set connection timeout\n            setConnectionLostTimeout(45);\n        }\n\n        @Override\n        public void onOpen(ServerHandshake handshake) {\n            log.info("Successfully connected");\n        }\n\n        @Override\n        public void onMessage(String message) {\n            try {\n                // Parse Pulsar message\n                PulsarMessage pulsarMsg = objectMapper.readValue(message, PulsarMessage.class);\n\n                // Check if this is a control message (don\'t print or ack these)\n                if (pulsarMsg.isControlMessage()) {\n                    return;\n                }\n\n                // Decode and print only the payload\n                String payload = pulsarMsg.decodePayloadAsString();\n                System.out.println(payload);\n\n                // Send acknowledgment (required for WebSocket flow control)\n                sendAck(pulsarMsg.getMessageId());\n\n            } catch (Exception e) {\n                log.error("Error processing message: {}", e.getMessage());\n            }\n        }\n\n        /**\n         * Send an acknowledgment message for a received message.\n         * This is REQUIRED for WebSocket readers to prevent backlog buildup and message delivery stoppage.\n         */\n        private void sendAck(String messageId) {\n            try {\n                Map<String, String> ackMsg = new HashMap<>();\n                ackMsg.put("messageId", messageId);\n                String ackJson = objectMapper.writeValueAsString(ackMsg);\n                send(ackJson);\n            } catch (Exception e) {\n                log.warn("Failed to send ack for messageId: {}", messageId, e);\n            }\n        }\n\n        @Override\n        public void onClose(int code, String reason, boolean remote) {\n            log.info("Connection closed: {} - {}", code, reason);\n            latch.countDown();\n        }\n\n        @Override\n        public void onError(Exception ex) {\n            log.error("WebSocket error: {}", ex.getMessage());\n            latch.countDown();\n        }\n\n        public void awaitClose() throws InterruptedException {\n            latch.await();\n        }\n    }\n\n    /**\n     * Parse command-line arguments.\n     */\n    private static Map<String, String> parseArgs(String[] args) {\n        Map<String, String> params = new HashMap<>();\n\n        // Defaults\n        // Example uses euw2 region. For other regions, see developer.8x8.com\n        params.put("host", "pulsar-ws-euw2.8x8.com");\n        params.put("port", "443");\n        params.put("namespace", "event-v1");\n        params.put("topic", "all");\n\n        // Get API key from environment variable\n        String apiKey = System.getenv("PULSAR_API_KEY");\n        if (apiKey != null && !apiKey.isEmpty()) {\n            params.put("x-api-key", apiKey);\n        }\n\n        for (int i = 0; i < args.length; i++) {\n            String arg = args[i];\n\n            if (arg.startsWith("--") && i + 1 < args.length) {\n                String key = arg.substring(2);\n                String value = args[++i];\n                params.put(key, value);\n            }\n        }\n\n        return params;\n    }\n\n    /**\n     * Main entry point.\n     */\n    public static void main(String[] args) {\n        PulsarWebSocketClient client = null;\n        try {\n            // Parse arguments\n            Map<String, String> params = parseArgs(args);\n\n            // Validate required parameters\n            if (!params.containsKey("tenant")) {\n                System.err.println("Error: --tenant is required");\n                System.exit(1);\n            }\n\n            // Build URL\n            String url = buildUrl(\n                    params.get("host"),\n                    Integer.parseInt(params.get("port")),\n                    params.get("tenant"),\n                    params.get("namespace"),\n                    params.get("topic"),\n                    params.get("x-api-key")\n            );\n\n            log.info("Connecting to WebSocket...");\n\n            // Create and connect WebSocket client\n            client = new PulsarWebSocketClient(\n                    new URI(url),\n                    params.get("x-api-key")\n            );\n\n            // Connect (blocking)\n            if (!client.connectBlocking()) {\n                log.error("Failed to connect to WebSocket");\n                System.exit(1);\n            }\n\n            // Wait for connection to close\n            client.awaitClose();\n\n        } catch (Exception e) {\n            log.error("Error: {}", e.getMessage(), e);\n            System.exit(1);\n        } finally {\n            if (client != null) {\n                try {\n                    client.close();\n                } catch (Exception e) {\n                    log.warn("Error closing WebSocket client: {}", e.getMessage());\n                }\n            }\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"key-components",children:"Key Components"}),"\n",(0,t.jsx)(n.h3,{id:"message-structure",children:"Message Structure"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"PulsarMessage"})," class uses Jackson annotations for JSON mapping:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@Data\nstatic class PulsarMessage {\n    // Data message fields\n    @JsonProperty("messageId")\n    private String messageId;\n\n    @JsonProperty("payload")\n    private String payload; // Base64 encoded\n\n    @JsonProperty("properties")\n    private Map<String, String> properties;\n\n    @JsonProperty("publishTime")\n    private String publishTime;\n\n    @JsonProperty("redeliveryCount")\n    private int redeliveryCount;\n\n    // Control message fields\n    @JsonProperty("type")\n    private String type;\n\n    @JsonProperty("endOfTopic")\n    private String endOfTopic;\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"url-construction",children:"URL Construction"}),"\n",(0,t.jsx)(n.p,{children:"The URL is built with proper encoding:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'String baseUrl = String.format("wss://%s:%d/ws/v2/reader/persistent/%s/%s/%s",\n        host, port, tenant, namespace, topic);\n\nif (xApiKey != null && !xApiKey.isEmpty()) {\n    baseUrl += "?x-api-key=" + URLEncoder.encode(xApiKey, StandardCharsets.UTF_8);\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,t.jsx)(n.p,{children:"X-API-Key is added as a header during connection:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'if (xApiKey != null && !xApiKey.isEmpty()) {\n    addHeader("X-API-Key", xApiKey);\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"payload-decoding",children:"Payload Decoding"}),"\n",(0,t.jsx)(n.p,{children:"The payload is decoded from base64:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public byte[] decodePayload() {\n    return Base64.getDecoder().decode(payload);\n}\n\npublic String decodePayloadAsString() {\n    return new String(decodePayload(), StandardCharsets.UTF_8);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"message-acknowledgement",children:"Message Acknowledgement"}),"\n",(0,t.jsx)(n.p,{children:"Acknowledgements are required to prevent message delivery stoppage:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'Map<String, String> ackMsg = new HashMap<>();\nackMsg.put("messageId", messageId);\nString ackJson = objectMapper.writeValueAsString(ackMsg);\nsend(ackJson);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"control-message-filtering",children:"Control Message Filtering"}),"\n",(0,t.jsx)(n.p,{children:"Control messages (like end-of-topic markers) should not be processed:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"if (pulsarMsg.isControlMessage()) {\n    return;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"maven-dependencies",children:"Maven Dependencies"}),"\n",(0,t.jsxs)(n.p,{children:["Add these dependencies to your ",(0,t.jsx)(n.code,{children:"pom.xml"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<dependencies>\n    \x3c!-- WebSocket client --\x3e\n    <dependency>\n        <groupId>org.java-websocket</groupId>\n        <artifactId>Java-WebSocket</artifactId>\n        <version>1.5.7</version>\n    </dependency>\n\n    \x3c!-- JSON processing --\x3e\n    <dependency>\n        <groupId>com.fasterxml.jackson.core</groupId>\n        <artifactId>jackson-databind</artifactId>\n        <version>2.18.1</version>\n    </dependency>\n\n    \x3c!-- Lombok for reducing boilerplate --\x3e\n    <dependency>\n        <groupId>org.projectlombok</groupId>\n        <artifactId>lombok</artifactId>\n        <version>1.18.36</version>\n        <scope>provided</scope>\n    </dependency>\n\n    \x3c!-- Logging --\x3e\n    <dependency>\n        <groupId>ch.qos.logback</groupId>\n        <artifactId>logback-classic</artifactId>\n        <version>1.5.12</version>\n    </dependency>\n</dependencies>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"building-and-running",children:"Building and Running"}),"\n",(0,t.jsx)(n.h3,{id:"build-with-maven",children:"Build with Maven"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mvn clean package\n"})}),"\n",(0,t.jsx)(n.h3,{id:"run-the-jar",children:"Run the JAR"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"java -jar target/pulsar-simple-client.jar \\\n  --tenant YOUR_TENANT \\\n  --x-api-key YOUR_API_KEY\n"})}),"\n",(0,t.jsx)(n.h3,{id:"using-environment-variables",children:"Using Environment Variables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"export PULSAR_API_KEY=your-api-key\n\njava -jar target/pulsar-simple-client.jar \\\n  --tenant YOUR_TENANT\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Option"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--tenant"})}),(0,t.jsx)(n.td,{children:"Your 8x8 tenant name (required)"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--host"})}),(0,t.jsx)(n.td,{children:"Pulsar broker hostname"}),(0,t.jsx)(n.td,{children:"pulsar-ws-euw2.8x8.com (EUW2)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--port"})}),(0,t.jsx)(n.td,{children:"Pulsar broker port"}),(0,t.jsx)(n.td,{children:"443"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--namespace"})}),(0,t.jsx)(n.td,{children:"Pulsar namespace"}),(0,t.jsx)(n.td,{children:"event-v1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--topic"})}),(0,t.jsx)(n.td,{children:"Topic name"}),(0,t.jsx)(n.td,{children:"all"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--x-api-key"})}),(0,t.jsx)(n.td,{children:"API key for authentication"}),(0,t.jsx)(n.td,{children:"(from PULSAR_API_KEY env var)"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.p,{children:"The example includes error handling for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Connection failures"}),"\n",(0,t.jsx)(n.li,{children:"Message parsing errors"}),"\n",(0,t.jsx)(n.li,{children:"Base64 decoding errors"}),"\n",(0,t.jsx)(n.li,{children:"WebSocket errors and disconnections"}),"\n",(0,t.jsx)(n.li,{children:"Acknowledgement send failures (logged as warnings)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Errors are logged using SLF4J with Logback."}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/actions-events/docs/streaming/examples/golang",children:"Go Client Example"})," - See the same functionality in Go"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/actions-events/docs/streaming/message-format",children:"Message Format"})," - Learn more about message structure"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/actions-events/docs/streaming/troubleshooting",children:"Troubleshooting"})," - Common issues and solutions"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);