"use strict";(self.webpackChunk_8x8_developer_docs=self.webpackChunk_8x8_developer_docs||[]).push([[75673],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var s=t(96540);const a={},r=s.createContext(a);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},65957:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>i});const s=JSON.parse('{"id":"connect/docs/guide-creating-whatsapp-template-request","title":"Constructing WhatsApp Template Send Requests","description":"Learn how to properly format and send WhatsApp template messages through the 8x8 API using both manual and automated approaches. This guide covers everything from basic template structure to advanced scripting for bulk template preparation.","source":"@site/docs/connect/docs/guide-creating-whatsapp-template-request.md","sourceDirName":"connect/docs","slug":"/connect/docs/guide-creating-whatsapp-template-request","permalink":"/production/connect/docs/guide-creating-whatsapp-template-request","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"sidebarConnectDocs","previous":{"title":"Usage samples","permalink":"/production/connect/docs/usage-samples-whatsapp"},"next":{"title":"Zero-tap and One-tap WhatsApp Authentication Template","permalink":"/production/connect/docs/guide-whatsapp-one-tap-or-zero-tap-authentication"}}');var a=t(74848),r=t(28453);const o={},l="Constructing WhatsApp Template Send Requests",c={},i=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Manual Method",id:"manual-method",level:2},{value:"1. Fetch Templates",id:"1-fetch-templates",level:3},{value:"2. Extract Template Details",id:"2-extract-template-details",level:3},{value:"3. Base API Request Structure",id:"3-base-api-request-structure",level:3},{value:"4. Compose the Message Payload",id:"4-compose-the-message-payload",level:3},{value:"Simple Template (No Parameters)",id:"simple-template-no-parameters",level:4},{value:"Media Template Example",id:"media-template-example",level:4},{value:"Body Parameters Example",id:"body-parameters-example",level:4},{value:"AUTHENTICATION Template Example",id:"authentication-template-example",level:4},{value:"5. Send the Message",id:"5-send-the-message",level:3},{value:"Automated Method",id:"automated-method",level:4},{value:"1. Setup",id:"1-setup",level:3},{value:"2. Generate cURL Scripts",id:"2-generate-curl-scripts",level:3},{value:"3. Use the Generated Scripts",id:"3-use-the-generated-scripts",level:3},{value:"Tips &amp; Best Practices",id:"tips--best-practices",level:4}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"constructing-whatsapp-template-send-requests",children:"Constructing WhatsApp Template Send Requests"})}),"\n",(0,a.jsx)(n.p,{children:"Learn how to properly format and send WhatsApp template messages through the 8x8 API using both manual and automated approaches. This guide covers everything from basic template structure to advanced scripting for bulk template preparation."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"WhatsApp Business templates are pre-approved message formats that allow businesses to initiate conversations with customers. This guide demonstrates two methods for sending these templates via the 8x8 API:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Method"}),(0,a.jsx)(n.th,{children:"Description"}),(0,a.jsx)(n.th,{children:"Best For"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Manual"}),(0,a.jsx)(n.td,{children:"Step-by-step process using curl and JSON payloads"}),(0,a.jsx)(n.td,{children:"One-off messages, learning the API"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Automated"}),(0,a.jsx)(n.td,{children:"Automated generation of ready-to-use cURL commands"}),(0,a.jsx)(n.td,{children:"Multiple templates, production workflows"})]})]})]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"8x8 API credentials (Account ID, Channel ID, Subaccount ID, API Key)"}),"\n",(0,a.jsx)(n.li,{children:"WhatsApp recipient phone number (E.164 format, e.g., +14155551212)"}),"\n",(0,a.jsxs)(n.li,{children:["WhatsApp templates created and approved either via the ",(0,a.jsx)(n.a,{href:"/connect/docs/whatsapp-templates-management",children:"Connect portal"})," or ",(0,a.jsx)(n.a,{href:"/connect/reference/add-whatsapp-template",children:"API"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://curl.se/",children:"curl"})," installed"]}),"\n",(0,a.jsxs)(n.li,{children:["For automated method: ",(0,a.jsx)(n.a,{href:"https://nodejs.org/",children:"Node.js"})," (v16+), ",(0,a.jsx)(n.code,{children:"npm install dotenv axios"})]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"manual-method",children:"Manual Method"}),"\n",(0,a.jsx)(n.h3,{id:"1-fetch-templates",children:"1. Fetch Templates"}),"\n",(0,a.jsx)(n.p,{children:"Run the following command in a terminal"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -s -X GET "https://chatapps.8x8.com/api/v1/accounts/{your_account_id}/channels/{your_channel_id}/templates" \\\n  -H "Authorization: Bearer {{your_api_key}}" \\\n  -H "Accept: application/json" > templates.json\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"2-extract-template-details",children:"2. Extract Template Details"}),"\n",(0,a.jsxs)(n.p,{children:["Open ",(0,a.jsx)(n.code,{children:"templates.json"})," in a text editor. Note:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"templateName"})," as per the GET Templates response (or ",(0,a.jsx)(n.code,{children:"name"}),") in the corresponding Send message we're trying to compose"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"language"})}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"components"})," (for required parameters)"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h3,{id:"3-base-api-request-structure",children:"3. Base API Request Structure"}),"\n",(0,a.jsx)(n.p,{children:"Every WhatsApp template message request to the 8x8 API must include the following fields:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "user": { "msisdn": "{{recipientPhoneNumber}}" },\n  "type": "template",\n  "content": {\n    "template": {\n      "name": "your_template_name",\n      "language": "template_language_code",\n      "components": [ /* see examples below */ ]\n    }\n  }\n}\n\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"user.msisdn"}),": The recipient's phone number in E.164 format."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"type"}),": Always ",(0,a.jsx)(n.code,{children:'"template"'})," for template messages."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"content.template.name"}),": The template name as shown in your templates list."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"content.template.language"}),": The language code (e.g., ",(0,a.jsx)(n.code,{children:'"en"'}),")."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"content.template.components"}),": An array of components (see examples below)."]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h3,{id:"4-compose-the-message-payload",children:"4. Compose the Message Payload"}),"\n",(0,a.jsxs)(n.p,{children:["Below are examples of the full payload for different template types. Replace the ",(0,a.jsx)(n.code,{children:"components"})," array as needed."]}),"\n",(0,a.jsx)(n.h4,{id:"simple-template-no-parameters",children:"Simple Template (No Parameters)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "user": { "msisdn": "{{recipientPhoneNumber}}" },\n  "type": "template",\n  "content": {\n    "template": {\n      "name": "{{your_template_name}}",\n      "language": "{{language_code}}",\n      "components": []\n    }\n  }\n}\n\n'})}),"\n",(0,a.jsx)(n.h4,{id:"media-template-example",children:"Media Template Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "user": { "msisdn": "{{recipientPhoneNumber}}" },\n  "type": "template",\n  "content": {\n    "template": {\n      "name": "{{your_template_name}}",\n      "language": "en",\n      "components": [\n        {\n          "type": "header",\n          "parameters": [\n            { "type": "image", "url": "{{header_image_url}}" }\n          ]\n        }\n      ]\n    }\n  }\n}\n\n'})}),"\n",(0,a.jsx)(n.h4,{id:"body-parameters-example",children:"Body Parameters Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "user": { "msisdn": "{{recipientPhoneNumber}}" },\n  "type": "template",\n  "content": {\n    "template": {\n      "name": "{{your_template_name}}",\n      "language": "en",\n      "components": [\n        {\n          "type": "body",\n          "parameters": [\n            { "type": "text", "text": "{{body_text_1}}" }\n          ]\n        }\n      ]\n    }\n  }\n}\n\n'})}),"\n",(0,a.jsx)(n.h4,{id:"authentication-template-example",children:"AUTHENTICATION Template Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "user": { "msisdn": "{{recipientPhoneNumber}}" },\n  "type": "template",\n  "content": {\n    "template": {\n      "name": "{{your_template_name}}",\n      "language": "en",\n      "components": [\n        {\n          "type": "body",\n          "parameters": [\n            { "type": "text", "text": "{{otpCode}}" }\n          ]\n        },\n        {\n          "type": "Button",\n          "subType": "url",\n          "index": 0,\n          "parameters": [\n            { "type": "text", "text": "{{otpCode}}" }\n          ]\n        }\n      ]\n    }\n  }\n}\n\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h3,{id:"5-send-the-message",children:"5. Send the Message"}),"\n",(0,a.jsxs)(n.p,{children:["Save your payload to ",(0,a.jsx)(n.code,{children:"message.json"})," and run the command below in the terminal"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'SUBACCOUNT_ID="your_subaccount_id"\nAPI_TOKEN="your_api_token"\n\ncurl -X POST "https://chatapps.8x8.com/api/v1/subaccounts/$SUBACCOUNT_ID/messages" \\\n  -H "Authorization: Bearer $API_TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d @message.json\n\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h4,{id:"automated-method",children:"Automated Method"}),"\n",(0,a.jsx)(n.h3,{id:"1-setup",children:"1. Setup"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Place ",(0,a.jsx)(n.a,{href:"https://gist.github.com/harrism04/c2ed6e3b4a7c7f888e3bdfc75f0cb91f",children:"generate-curl-scripts.js"})," in your project directory."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// @ts-check\nrequire('dotenv').config();\nconst axios = require('axios');\nconst fs = require('fs');\nconst path = require('path');\n\nconst API_BASE_URL = process.env.API_BASE_URL || 'https://chatapps.8x8.com';\nconst ACCOUNT_ID = process.env.ACCOUNT_ID || '';\nconst CHANNEL_ID = process.env.CHANNEL_ID || '';\nconst SUBACCOUNT_ID = process.env.SUBACCOUNT_ID || '';\nconst API_KEY = process.env.API_KEY || '';\n\nconst OUTPUT_DIR = 'generated_curl_scripts';\n\nfunction getComponents(template) {\n  if (\n    (template.type && template.type.toUpperCase() === 'AUTHENTICATION') ||\n    (template.category && template.category.toUpperCase() === 'AUTHENTICATION')\n  ) {\n    return [\n      {\n        \"type\": \"body\",\n        \"parameters\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"{{otpCode}}\" // Using placeholder for OTP\n          }\n        ]\n      },\n      {\n        \"type\": \"Button\",\n        \"subType\": \"url\",\n        \"index\": 0,\n        \"parameters\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"{{otpCode}}\" // Using placeholder for OTP\n          }\n        ]\n      }\n    ];\n  }\n\n  // For other templates, generate descriptive placeholders based on structure\n  const components = [];\n  if (template.components) {\n    template.components.forEach(component => {\n      const componentType = component.type.toUpperCase();\n      if (componentType === 'HEADER') {\n        const format = component.format?.toUpperCase();\n        if (format === 'TEXT' && component.text) {\n          const placeholders = findPlaceholders(component.text);\n          if (placeholders.length > 0) {\n            components.push({\n              type: \"header\",\n              parameters: placeholders.map(num => ({ type: \"text\", text: `{{header_text_${num}}}` }))\n            });\n          }\n        } else if (['IMAGE', 'VIDEO', 'DOCUMENT'].includes(format)) {\n           components.push({\n              type: \"header\",\n              parameters: [{ type: format.toLowerCase(), url: `{{header_${format.toLowerCase()}_url}}` }]\n            });\n        } else if (format === 'LOCATION') {\n             components.push({\n                type: \"header\",\n                location: { latitude: \"{{header_loc_lat}}\", longitude: \"{{header_loc_lon}}\", name: \"{{header_loc_name}}\", address: \"{{header_loc_addr}}\" }\n             });\n        }\n      } else if (componentType === 'BODY' && component.text) {\n        const placeholders = findPlaceholders(component.text);\n        if (placeholders.length > 0) {\n          components.push({\n            type: \"body\",\n            parameters: placeholders.map(num => ({ type: \"text\", text: `{{body_text_${num}}}` }))\n          });\n        }\n      } else if (componentType === 'BUTTONS' && component.buttons) {\n          component.buttons.forEach((button, buttonIndex) => {\n              if (button.type.toUpperCase() === 'URL' && button.url) {\n                  const placeholders = findPlaceholders(button.url);\n                  if (placeholders.length > 0) {\n                      components.push({\n                          type: \"button\",\n                          subType: \"url\",\n                          index: buttonIndex,\n                          parameters: placeholders.map(num => ({ type: \"text\", text: `{{button_${buttonIndex}_url_param_${num}}}` }))\n                      });\n                  }\n              }\n          });\n      }\n    });\n  }\n\n  return components;\n}\n\n// Extracts {{n}} placeholders from a string (copied from static/script.js)\nfunction findPlaceholders(text) {\n    if (!text) return [];\n    const regex = /{{(\\d+)}}/g;\n    const placeholders = new Set();\n    let match;\n    while ((match = regex.exec(text)) !== null) {\n        placeholders.add(parseInt(match[1], 10));\n    }\n    return Array.from(placeholders).sort((a, b) => a - b);\n}\n\nasync function fetchTemplates() {\n  const url = `${API_BASE_URL}/api/v1/accounts/${ACCOUNT_ID}/channels/${CHANNEL_ID}/templates`;\n  const headers = { Authorization: `Bearer ${API_KEY}` };\n  const { data } = await axios.get(url, { headers });\n  return data.templates || [];\n}\n\nfunction generateCurlCommand(template) {\n  const payload = {\n    user: { msisdn: '{{recipientPhoneNumber}}' }, // Use placeholder here\n    type: 'template',\n    content: {\n      template: {\n        name: template.templateName || template.name,\n        language: template.language || 'en',\n        components: getComponents(template)\n      }\n    }\n  };\n\n  const jsonString = JSON.stringify(payload, null, 2);\n  const escapedJsonString = jsonString.replace(/'/g, \"'\\\\''\");\n\n  const curlCommand = `curl -X POST \\\\\n  '${API_BASE_URL}/api/v1/subaccounts/${SUBACCOUNT_ID}/messages' \\\\\n  -H 'Authorization: Bearer {{apiKey}}' \\\\\n  -H 'Content-Type: application/json' \\\\\n  -d '${escapedJsonString}'`;\n\n  return curlCommand;\n}\n\n(async () => {\n  try {\n    if (!fs.existsSync(OUTPUT_DIR)) {\n      fs.mkdirSync(OUTPUT_DIR);\n    }\n\n    const templates = await fetchTemplates();\n    if (templates.length === 0) {\n      console.log('No templates found.');\n      return;\n    }\n\n    console.log(`Generating cURL scripts for ${templates.length} templates in ./${OUTPUT_DIR}/`);\n\n    for (const template of templates) {\n      const templateName = template.templateName || template.name;\n      const language = template.language || 'en';\n      const filename = `${templateName}_${language}.sh`;\n      const filepath = path.join(OUTPUT_DIR, filename);\n      const curlCommand = generateCurlCommand(template);\n\n      const scriptContent = `#!/bin/bash\n# cURL command for template: ${templateName} (${language})\n# Category: ${template.category || 'N/A'}\n\n# Replace {{apiKey}} with your actual 8x8 API Key\n# Replace placeholder values in the -d payload as needed, including {{recipientPhoneNumber}}\n\n${curlCommand}\n`;\n\n      fs.writeFileSync(filepath, scriptContent);\n      fs.chmodSync(filepath, '755'); // Make the script executable\n    }\n\n    console.log('cURL scripts generated successfully.');\n\n  } catch (err) {\n    console.error('Failed to generate cURL scripts:', err.message);\n  }\n})();\n\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Install dependencies:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm install dotenv axios\n\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Create a ",(0,a.jsx)(n.code,{children:".env"})," file:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"API_BASE_URL=https://chatapps.8x8.com # replace with endpoint associated with your DC region https://developer.8x8.com/connect/docs/data-center-region#api-endpoints-and-data-center-region\nACCOUNT_ID=your_account_id\nCHANNEL_ID=your_channel_id\nSUBACCOUNT_ID=your_subaccount_id\nAPI_KEY=your_api_key\n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-generate-curl-scripts",children:"2. Generate cURL Scripts"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"node generate-curl-scripts\n\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["This creates a ",(0,a.jsx)(n.code,{children:"generated_curl_scripts"})," directory with ",(0,a.jsx)(n.code,{children:".sh"})," files for each template."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-use-the-generated-scripts",children:"3. Use the Generated Scripts"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Edit the ",(0,a.jsx)(n.code,{children:".sh"})," file:\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Replace ",(0,a.jsx)(n.code,{children:"{{apiKey}}"})," with your API Key."]}),"\n",(0,a.jsxs)(n.li,{children:["Replace placeholders (e.g., ",(0,a.jsx)(n.code,{children:"{{recipientPhoneNumber}}"}),", ",(0,a.jsx)(n.code,{children:"{{otpCode}}"}),") with real values."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Run the script:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"./your_template_en.sh\n\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h4,{id:"tips--best-practices",children:"Tips & Best Practices"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Always replace placeholders with real values before sending."}),"\n",(0,a.jsx)(n.li,{children:"Test with a non-production recipient first."}),"\n",(0,a.jsxs)(n.li,{children:["Review API responses or ",(0,a.jsx)(n.a,{href:"/connect/reference/delivery-receipts-for-outbound-chatapps",children:"delivery receipts"})," for errors. You can also check the ",(0,a.jsx)(n.a,{href:"/connect/docs/messaging-apps#logs",children:"Logs"})," and take action from there."]}),"\n",(0,a.jsx)(n.li,{children:"From time to time, Meta might not deliver messages to maintain a healthy ecosystem (Error Code: 131049 and similar), so you can try sending it to a secondary non-production recipient or try again later"}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}}}]);